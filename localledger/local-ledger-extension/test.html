<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Popup Test Page</title>
</head>
<body>
    <h1>Testing Popup Functionality</h1>
    <button id="invokeApi">Invoke Chrome API</button>

    <script>
        // Unified Chrome API Mock which assumes presence and functionality
        window.chrome = window.chrome || {};
        chrome.runtime = {
            sendMessage: function(message, callback) {
                console.log("Mock sendMessage called with message:", message);
                callback({farewell: "Goodbye from mock!"}); // Simulate a response
            },
            onMessage: {
                addListener: function(listener) {
                    console.log("Mock addListener called.");
                    setTimeout(() => listener({greeting: "hello"}, {tab: {id: 123}}, () => {}), 1000);
                }
            }
        };
    </script>

    <script src="popup.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var button = document.getElementById('invokeApi');
            console.log('Content loaded, adding event listener.');

            if (button) {
                button.addEventListener('click', function() {
                    console.log('Button clicked');
                    try {
                       if (chrome.runtime && chrome.runtime.sendMessage) {
                        chrome.runtime.sendMessage({greeting: "hello"}, function(response) {
                            alert('Response: ' + response.farewell);
                        });
                       } else {
                           console.error("sendMessage not available");
                       }
                    } catch (error) {
                        console.error('Error sending message:', error);
                    }
                });
            } else {
                console.error('The button with ID "invokeApi" was not found.');
            }
        });
    </script>
</body>
</html>
